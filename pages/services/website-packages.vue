<script setup lang="ts">
import { ref, onMounted, onUnmounted } from "vue";
import type { SectionNavItem } from "~/components/services/SectionNav.vue";

const { t, tm } = useI18n();

useSeoMeta({
  title: () => t("servicesSubpages.websitePackages.meta.title"),
  description: () => t("servicesSubpages.websitePackages.meta.description"),
  ogTitle: () => t("servicesSubpages.websitePackages.meta.title"),
  ogDescription: () => t("servicesSubpages.websitePackages.meta.description"),
  ogType: "website",
  ogUrl: "https://eyeonidea.com/services/website-packages",
  twitterCard: "summary_large_image",
  twitterTitle: () => t("servicesSubpages.websitePackages.meta.title"),
  twitterDescription: () => t("servicesSubpages.websitePackages.meta.description"),
});

useHead({
  link: [{ rel: "canonical", href: "https://eyeonidea.com/services/website-packages" }],
});

const breadcrumbs = computed(() => [
  { label: "Home", to: "/" },
  { label: t("servicesSubpages.websitePackages.breadcrumb.services"), to: "/services" },
  { label: t("servicesSubpages.websitePackages.breadcrumb.current") },
]);

const navSections = computed<SectionNavItem[]>(() => [
  { id: "packages-section",     label: t("servicesSubpages.websitePackages.nav.packages"),   icon: "i-heroicons-cube" },
  { id: "comparison-section",   label: t("servicesSubpages.websitePackages.nav.comparison"), icon: "i-heroicons-table-cells" },
  { id: "cms-section",          label: t("servicesSubpages.websitePackages.nav.cms"),        icon: "i-heroicons-square-3-stack-3d" },
  { id: "hosting-section",      label: t("servicesSubpages.websitePackages.nav.hosting"),    icon: "i-heroicons-server" },
  { id: "before-after-section", label: t("servicesSubpages.websitePackages.nav.results"),    icon: "i-heroicons-chart-bar" },
]);

const hostingData = computed(() => t("servicesSubpages.websitePackages.hosting.hostingCard", {}, { missingWarn: false }) ? {
  badge:       t("servicesSubpages.websitePackages.hosting.hostingCard.badge"),
  title:       t("servicesSubpages.websitePackages.hosting.hostingCard.title"),
  description: t("servicesSubpages.websitePackages.hosting.hostingCard.description"),
  bullets:     tm("servicesSubpages.websitePackages.hosting.hostingCard.bullets") as string[],
  price:       t("servicesSubpages.websitePackages.hosting.hostingCard.price"),
  currency:    t("servicesSubpages.websitePackages.hosting.hostingCard.currency"),
  unit:        t("servicesSubpages.websitePackages.hosting.hostingCard.unit"),
  vatNote:     t("servicesSubpages.websitePackages.hosting.hostingCard.vatNote"),
} : null);

const domainData = computed(() => ({
  title:        t("servicesSubpages.websitePackages.hosting.domainCard.title"),
  description:  t("servicesSubpages.websitePackages.hosting.domainCard.description"),
  includedNote: t("servicesSubpages.websitePackages.hosting.domainCard.includedNote"),
  linkText:     t("servicesSubpages.websitePackages.hosting.domainCard.linkText"),
  linkHref:     t("servicesSubpages.websitePackages.hosting.domainCard.linkHref"),
}));

// Intersection observer for hosting section
const hostingRef = ref<HTMLElement | null>(null);
const hostingVisible = ref(false);

onMounted(() => {
  if (!hostingRef.value) return;
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          hostingVisible.value = true;
          observer.disconnect();
        }
      });
    },
    { threshold: 0.1 },
  );
  observer.observe(hostingRef.value);
  onUnmounted(() => observer.disconnect());
});
</script>

<template>
  <div class="website-packages-page">

    <!-- Hero -->
    <BaseHero
      :badge="t('servicesSubpages.websitePackages.hero.badge')"
      :title="t('servicesSubpages.websitePackages.hero.title')"
      :subtitle="t('servicesSubpages.websitePackages.hero.subtitle')"
      heading-id="packages-hero-heading"
      variant="dark"
    >
      <template #after-subtitle>
        <div class="hero-breadcrumb">
          <Breadcrumb :crumbs="breadcrumbs" aria-label="Breadcrumb navigation" />
        </div>
      </template>
    </BaseHero>

    <!-- Sticky Section Navigation -->
    <ServicesSectionNav
      :sections="navSections"
      :aria-label="t('servicesSubpages.websitePackages.hero.badge')"
    />

    <!-- Package Cards -->
    <ServicesPackagesSection />

    <!-- Comparison Table -->
    <ServicesComparisonTable />

    <!-- CMS Section -->
    <ServicesCMSSection />

    <!-- Hosting and Domain -->
    <section
      id="hosting-section"
      ref="hostingRef"
      class="hosting-section"
      aria-labelledby="hosting-heading"
    >
      <div class="hosting-container">
        <SectionHeader
          :badge="t('servicesSubpages.websitePackages.hosting.badge')"
          :title="t('servicesSubpages.websitePackages.hosting.title')"
          :subtitle="t('servicesSubpages.websitePackages.hosting.subtitle')"
          heading-id="hosting-heading"
          align="center"
        />

        <div class="hosting-grid" :class="{ 'animate-in': hostingVisible }">

          <!-- EU Hosting card -->
          <GlassCard
            variant="solid"
            hover-effect="lift"
            class="hosting-card stagger-1"
          >
            <div class="card-inner">
              <div class="card-top">
                <span class="eu-badge">
                  <span aria-hidden="true">ðŸ‡ªðŸ‡º</span>
                  {{ t('servicesSubpages.websitePackages.hosting.hostingCard.badge') }}
                </span>
                <h3 class="card-title">
                  {{ t('servicesSubpages.websitePackages.hosting.hostingCard.title') }}
                </h3>
                <p class="card-description">
                  {{ t('servicesSubpages.websitePackages.hosting.hostingCard.description') }}
                </p>
                <ul class="card-bullets" role="list">
                  <li
                    v-for="(bullet, i) in (tm('servicesSubpages.websitePackages.hosting.hostingCard.bullets') as string[])"
                    :key="i"
                    class="bullet-item"
                  >
                    <UIcon name="i-heroicons-check-circle" class="bullet-icon" aria-hidden="true" />
                    <span>{{ bullet }}</span>
                  </li>
                </ul>
              </div>
              <div class="card-price">
                <span class="price-from">From</span>
                <span class="price-amount">
                  {{ t('servicesSubpages.websitePackages.hosting.hostingCard.currency') }}{{ t('servicesSubpages.websitePackages.hosting.hostingCard.price') }}
                </span>
                <span class="price-unit">/ {{ t('servicesSubpages.websitePackages.hosting.hostingCard.unit') }}</span>
                <span class="price-vat">{{ t('servicesSubpages.websitePackages.hosting.hostingCard.vatNote') }}</span>
              </div>
            </div>
          </GlassCard>

          <!-- Domain card -->
          <GlassCard
            variant="outlined"
            hover-effect="lift"
            class="hosting-card stagger-2"
          >
            <div class="card-inner">
              <div class="card-top">
                <span class="included-badge">
                  <UIcon name="i-heroicons-check-badge" class="included-badge__icon" aria-hidden="true" />
                  {{ t('servicesSubpages.websitePackages.hosting.domainCard.includedNote') }}
                </span>
                <h3 class="card-title">
                  {{ t('servicesSubpages.websitePackages.hosting.domainCard.title') }}
                </h3>
                <p class="card-description">
                  {{ t('servicesSubpages.websitePackages.hosting.domainCard.description') }}
                </p>
              </div>
              <NuxtLink
                :to="t('servicesSubpages.websitePackages.hosting.domainCard.linkHref')"
                class="domain-link"
              >
                {{ t('servicesSubpages.websitePackages.hosting.domainCard.linkText') }}
                <UIcon name="i-heroicons-arrow-right" class="domain-link__icon" aria-hidden="true" />
              </NuxtLink>
            </div>
          </GlassCard>

        </div>
      </div>
    </section>

    <!-- Before / After Results -->
    <ServicesBeforeAfter />

    <!-- CTA -->
    <BaseCTASection
      :badge="t('servicesSubpages.websitePackages.cta.badge')"
      :title="t('servicesSubpages.websitePackages.cta.title')"
      :description="t('servicesSubpages.websitePackages.cta.description')"
      :primary-text="t('servicesSubpages.websitePackages.cta.primaryText')"
      primary-to="/contact"
      :secondary-text="t('servicesSubpages.websitePackages.cta.secondaryText')"
      secondary-to="/services/additional-services"
      heading-id="packages-cta-heading"
    />

  </div>
</template>

<style lang="scss" scoped>
.website-packages-page {
  min-height: 100vh;
}

.hero-breadcrumb {
  margin-top: 2rem;
}

/* Offset smooth-scroll targets */
:deep(#packages-section),
:deep(#comparison-section),
:deep(#cms-section),
:deep(#hosting-section),
:deep(#before-after-section) {
  scroll-margin-top: 136px;
}

// â”€â”€â”€ Hosting section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

.hosting-section {
  padding: 6rem 1.5rem;
  background: var(--color-section-light);

  @media (min-width: 768px) {
    padding: 8rem 2rem;
  }

  @media (min-width: 1024px) {
    padding: 10rem 2rem;
  }
}

.hosting-container {
  max-width: 900px;
  margin: 0 auto;
}

.hosting-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;

  @media (min-width: 768px) {
    grid-template-columns: repeat(2, 1fr);
  }

  &.animate-in {
    .hosting-card {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

.hosting-card {
  opacity: 0;
  transform: translateY(24px);
  transition:
    opacity 0.6s var(--ease-smooth),
    transform 0.6s var(--ease-smooth);

  &.stagger-1 { transition-delay: 80ms; }
  &.stagger-2 { transition-delay: 200ms; }
}

// â”€â”€â”€ Card internals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

.card-inner {
  display: flex;
  flex-direction: column;
  height: 100%;
  gap: 1.5rem;
}

.card-top {
  flex: 1;
}

// EU badge
.eu-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.375rem 0.875rem;
  background: color-mix(in srgb, var(--color-accent-500) 12%, transparent);
  border: 1px solid color-mix(in srgb, var(--color-accent-500) 25%, transparent);
  border-radius: 9999px;
  font-size: var(--text-xs);
  font-weight: 700;
  color: var(--color-accent-600);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 1rem;
}

// Included badge
.included-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.375rem 0.875rem;
  background: color-mix(in srgb, var(--color-primary-500) 10%, transparent);
  border: 1px solid color-mix(in srgb, var(--color-primary-500) 20%, transparent);
  border-radius: 9999px;
  font-size: var(--text-xs);
  font-weight: 700;
  color: var(--color-primary-600);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 1rem;
}

.included-badge__icon {
  width: 14px;
  height: 14px;
}

.card-title {
  font-size: var(--text-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin-bottom: 0.75rem;
  line-height: 1.3;
}

.card-description {
  font-size: var(--text-sm);
  line-height: 1.7;
  color: var(--color-text-muted);
}

// Bullet list
.card-bullets {
  list-style: none;
  padding: 0;
  margin: 1rem 0 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.bullet-item {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  line-height: 1.5;
}

.bullet-icon {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  color: var(--color-accent-500);
  margin-top: 1px;
}

// Pricing display
.card-price {
  display: flex;
  align-items: baseline;
  flex-wrap: wrap;
  gap: 0.25rem 0.375rem;
  padding-top: 1.25rem;
  border-top: 1px solid var(--color-border);
}

.price-from {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}

.price-amount {
  font-family: var(--font-display);
  font-size: var(--text-2xl);
  font-weight: 700;
  color: var(--color-primary-600);
  letter-spacing: -0.02em;
}

.price-unit {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}

.price-vat {
  width: 100%;
  font-size: var(--text-xs);
  color: var(--color-text-subtle);
}

// Domain link
.domain-link {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--color-primary-600);
  text-decoration: none;
  min-height: 44px;
  transition: gap var(--duration-fast) var(--ease-smooth),
    color var(--duration-fast) var(--ease-smooth);

  &:hover {
    color: var(--color-primary-700);
    gap: 0.625rem;
  }

  &:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 2px;
    border-radius: 4px;
  }
}

.domain-link__icon {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
  transition: transform var(--duration-fast) var(--ease-smooth);

  .domain-link:hover & {
    transform: translateX(3px);
  }
}

// â”€â”€â”€ Dark mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

:root.dark {
  .hosting-section {
    background: var(--color-section-dark);
  }

  .eu-badge {
    color: var(--color-accent-400);
    background: color-mix(in srgb, var(--color-accent-400) 10%, transparent);
    border-color: color-mix(in srgb, var(--color-accent-400) 20%, transparent);
  }

  .included-badge {
    color: var(--color-primary-300);
    background: color-mix(in srgb, var(--color-primary-400) 10%, transparent);
    border-color: color-mix(in srgb, var(--color-primary-400) 20%, transparent);
  }

  .price-amount {
    color: var(--color-primary-300);
  }

  .domain-link {
    color: var(--color-primary-300);

    &:hover {
      color: var(--color-primary-200);
    }
  }

  .bullet-icon {
    color: var(--color-accent-400);
  }
}

// â”€â”€â”€ Reduced motion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

@media (prefers-reduced-motion: reduce) {
  .hosting-card {
    opacity: 1;
    transform: none;
    transition: none;
  }

  .domain-link,
  .domain-link__icon {
    transition: none;
  }
}
</style>
